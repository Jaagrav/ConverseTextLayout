<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="theme-color" content="#000000" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Converse</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!--https://source.unsplash.com/1000x2000/?colorful bokeh-->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Baloo+Thambi+2&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Montserrat&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Baloo+Thambi+2&display=swap");
      body {
        padding: 0;
        margin: 0;
        background: url("https://images.unsplash.com/photo-1518123877527-f4255b0c7795?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=2000&ixid=eyJhcHBfaWQiOjF9&ixlib=rb-1.2.1&q=80&w=1000");
        background-repeat: no-repeat;
        background-position: center;
      }

      .messageBody {
        position: relative;
        flex: 1 1 auto;
        height: 10pc;
        min-height: 0;
        min-width: 0;
        -webkit-box-align: stretch;
        -webkit-box-pack: end;
        justify-content: flex-end;
        overflow-x: hidden;
        overflow-y: auto;
        top: -5pc;
      }
      .textHolder {
        position: relative;
        width: 100%;
        margin: auto;
        right: 0;
        left: 0;
        height: fit-content;
        color: white;
        padding-bottom: 18px;
        display: inline-flex;
        font-family: "Baloo Thambi 2", cursive;
      }
      .myText {
        position: relative;
        height: fit-content;
        width: fit-content;
        max-width: 15pc;
        min-width: 6pc;
        padding: 8px;
        background: rgb(233, 233, 233);
        display: inline-flex;
        margin-left: auto;
        right: 0;
        z-index: -5;
        border-radius: 35px 0 0 35px;
        color: black;
        word-wrap: break-word;
      }
      .theirText {
        position: relative;
        height: fit-content;
        width: fit-content;
        max-width: 15pc;
        min-width: 6pc;
        padding: 8px;
        z-index: -5;
        background: linear-gradient(
          35deg,
          rgb(91, 155, 250),
          rgb(91, 155, 250),
          rgb(122, 27, 212)
        );
        display: inline-flex;
        margin-right: auto;
        left: 0;
        word-wrap: break-word;
        color: rgb(255, 255, 255);
        border-radius: 0 35px 35px 0;
      }
      .myMyText {
        position: relative;
        height: 100%;
        width: fit-content;
        margin-left: auto;
        right: 0;
        max-width: 11pc;
        word-break: break-word;
        word-wrap: break-word;
        margin: auto;
      }
      .theirTheirText {
        position: relative;
        height: 100%;
        max-width: 11pc;
        width: fit-content;
        margin-right: auto;
        word-break: break-word;
        left: 0;
        word-wrap: break-word;
        margin: auto;
      }
      .myTextImg {
        position: relative;
        height: 50px;
        border-radius: 50%;
        margin-right: 10px;
        margin-top: auto;
        bottom: 0;
      }
      .theirTextImg {
        position: relative;
        height: 50px;
        border-radius: 50%;
        margin-left: 10px;
        margin-top: auto;
        bottom: 0;
      }
      .myTimeStamp {
        position: absolute;
        height: fit-content;
        width: fit-content;
        color: white;
        font-size: 15px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        bottom: 0;
        right: 3px;
      }

      .theirTimeStamp {
        position: absolute;
        height: fit-content;
        width: fit-content;
        font-size: 15px;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        bottom: 0;
        left: 3px;
      }
      .header {
        position: relative;
        height: 10pc;
        width: 100%;
        background: transparent;
        margin: auto;
        top: 0;
        right: 0;
        left: 0;
      }
      .opponentUserMiniData {
        height: 100%;
        width: 100%;
        position: absolute;
        margin: auto;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
      }
      .backBtn {
        position: absolute;
        background: transparent;
        height: 30px;
        outline: none;
        border: none;
        filter: invert(1);
        margin: auto;
        left: 15px;
        top: 30px;
      }
      .profileImgContainer {
        position: relative;
        margin: 10px;
        margin-left: auto;
        right: 0;
        border-radius: 50%;
        height: 55px;
        width: 55px;
        overflow: hidden;
        border: 4px solid rgb(8, 255, 131);
        box-shadow: 0 0 10px rgb(8, 255, 131);
        transition: 0.5s;
      }
      .profileImg {
        position: absolute;
        margin: auto;
        bottom: 0;
        right: 0;
        left: 0;
        top: 0;
        border-radius: 50%;
        height: 88%;
      }
      .header .name {
        color: white;
        position: relative;
        height: fit-content;
        width: 250px;
        margin-left: auto;
        right: 85px;
        top: -50px;
        font-size: 25px;
        font-family: "Baloo Thambi 2", cursive;
        text-align: right;
        line-height: 20px;
        word-wrap: normal;
      }
      .footer {
        position: absolute;
        margin: auto;
        bottom: 0;
        right: 0;
        left: 0;
        height: 5pc;
        width: 100%;
        max-height: 88px;
      }
      .textField {
        position: absolute;
        height: 10%;
        width: 20pc;
        resize: none;
        border-radius: 35px;
        border: none;
        padding: 20px;
        bottom: 18px;
        margin: auto;
        right: 0;
        left: 0;
        color: white;
        font-size: 20px;
        outline: none;
        background: transparent;
        border: 1px solid rgb(255, 255, 255);
        backdrop-filter: blur(20px);
        font-family: "Baloo Thambi 2", cursive;
        padding-right: 60px;
      }
      .textField::placeholder {
        color: white;
      }
      .sendBtn {
        position: absolute;
        margin: auto;
        height: fit-content;
        width: fit-content;
        top: 0;
        bottom: 7px;
        background: transparent;
        border: none;
        outline: none;
        color: white;
        right: 25px;
        transition: 0.4s;
      }
      .joiningPage {
        position: absolute;
        height: 100%;
        width: 100%;
        margin: auto;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          rgb(91, 155, 250),
          rgb(122, 27, 212)
        );
        z-index: +5;
        transition: 1s;
      }
      .appName {
        height: fit-content;
        width: fit-content;
        position: absolute;
        font-size: 80px;
        margin: auto;
        right: 0;
        left: 0;
        color: rgb(0, 0, 0);
        font-family: "Baloo Thambi 2", cursive;
      }
      .joinForm {
        position: absolute;
        height: 20pc;
        width: 90%;
        margin: auto;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
      }
      .inputUserName,
      .inputUserSLID {
        position: relative;
        height: 20px;
        width: 80%;
        font-family: "Baloo Thambi 2", cursive;
        margin: auto;
        right: 0;
        left: 0;
        padding: 20px;
        margin-bottom: 30px;
        font-size: 25px;
        border: 0;
        border-radius: 50px;
        outline: none;
      }
      .submitBtn {
        position: relative;
        height: fit-content;
        width: 100px;
        margin: auto;
        font-family: "Baloo Thambi 2", cursive;
        right: 0;
        left: 0;
        background: teal;
        border: 0;
        border-radius: 50px;
        font-size: 50px;
        outline: none;
      }
      .homePage {
        position: absolute;
        height: 100%;
        width: 100%;
        margin: auto;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        background: #111;
        z-index: +3;
        transition: 1s;
      }
      .myProfileShow {
        position: relative;
        margin: auto 0;
        height: 15pc;
        width: 100%;
        background: url("https://source.unsplash.com/400x400/?colorful bokeh");
        border-radius: 0 0 50px 50px;
        background-size: cover;
      }
      .userNameShow {
        position: absolute;
        height: fit-content;
        width: fit-content;
        margin: auto;
        right: 0;
        bottom: 10px;
        left: 0;
        color: white;
        font-size: 60px;
        font-family: "Baloo Thambi 2", cursive;
        line-height: 55px;
      }
      .proPic {
        position: absolute;
        height: 150px;
        margin: auto;
        top: 20px;
        border-radius: 50%;
        right: 0;
        left: 0;
      }
      .chats {
        position: relative;
        height: 43.8pc;
        width: 100%;
        margin: auto;
        right: 0;
        left: 0;
        background: transparent;
        border-radius: 100px 0 0 0;
      }
      .chatsContainer {
        position: absolute;
        height: 100%;
        width: 90%;
        margin: auto;
        bottom: 0;
        right: 0;
        left: 0;
        overflow-x: hidden;
        overflow-y: auto;
      }
      .chat {
        position: relative;
        height: 120px;
        width: 90%;
        margin: auto;
        right: 0;
        left: 0;
        border-bottom: 2px solid #333;
        background: #111;
        margin-bottom: 10px;
      }
      .chatProPic {
        position: absolute;
        height: 90px;
        margin: auto;
        top: 0;
        bottom: 0;
        left: 10px;
        border-radius: 50%;
      }
      .chatName {
        position: absolute;
        height: fit-content;
        width: fit-content;
        margin: auto;
        top: 0;
        bottom: 0;
        font-size: 30px;
        right: 30px;
        color: white;
        font-family: "Baloo Thambi 2", cursive;
      }
      .headerColor {
        position: absolute;
        height: 9pc;
        width: 100%;
        margin: auto;
        top: 0;
        right: 0;
        left: 0;
        background: linear-gradient(black, rgb(0, 0, 36), transparent);
      }
    </style>
  </head>
  <body>
    <div class="headerColor"></div>
    <div class="joiningPage">
      <h1 class="appName">Converse</h1>
      <form class="joinForm">
        <center>
          <input
            type="text"
            class="inputUserName"
            placeholder="What's your name?"
            required
          />
          <input
            type="text"
            class="inputUserSLID"
            placeholder="Your SoloLearn account link"
            required
          />
          <button class="submitBtn">Go</button>
        </center>
      </form>
    </div>
    <div class="homePage">
      <div class="myProfileShow">
        <h1 class="userNameShow">Jaagrav</h1>
        <img
          src="https://instagram.fccu3-1.fna.fbcdn.net/v/t51.2885-19/s320x320/93816637_3160050547352339_7564488790480257024_n.jpg?_nc_ht=instagram.fccu3-1.fna.fbcdn.net&_nc_ohc=QbitMOoV-YgAX81ZKKe&oh=3416539fabc0837bedf8fba6ddb3ef48&oe=5ECE7B13"
          class="proPic"
        />
      </div>
      <div class="chats">
        <div class="chatsContainer">
          <div class="chat">
            <img
              src="https://api.sololearn.com/Uploads/Avatars/11500335.jpg"
              class="chatProPic"
            />
            <h2 class="chatName">Jaagrav</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="header">
      <div class="opponentUserMiniData">
        <button class="backBtn" onclick="backToHome()">
          <img
            style="height: 25px;"
            src="https://cdn.onlinewebfonts.com/svg/img_414032.png"
          />
        </button>
        <div class="profileImgContainer">
          <img
            src="https://source.unsplash.com/50x50/?flowers,nature,people"
            class="profileImg"
          />
        </div>
        <div class="name">Parth Saini</div>
      </div>
    </div>
    <div class="messageBody">
      <br /><br />
      <div class="textHolder">
        <div class="myText">
          <img
            src="https://instagram.fccu3-1.fna.fbcdn.net/v/t51.2885-19/s320x320/93816637_3160050547352339_7564488790480257024_n.jpg?_nc_ht=instagram.fccu3-1.fna.fbcdn.net&_nc_ohc=QbitMOoV-YgAX81ZKKe&oh=3416539fabc0837bedf8fba6ddb3ef48&oe=5ECE7B13"
            class="myTextImg"
          />
          <div class="myMyText">
            Hi!
          </div>
        </div>
        <div class="myTimeStamp">10:57</div>
      </div>
      <div class="textHolder">
        <div class="theirText">
          <div class="theirTheirText">
            Hey! How are you?
          </div>
          <img
            src="https://instagram.fccu3-1.fna.fbcdn.net/v/t51.2885-19/s320x320/93816637_3160050547352339_7564488790480257024_n.jpg?_nc_ht=instagram.fccu3-1.fna.fbcdn.net&_nc_ohc=QbitMOoV-YgAX81ZKKe&oh=3416539fabc0837bedf8fba6ddb3ef48&oe=5ECE7B13"
            class="theirTextImg"
          />
        </div>
      </div>
    </div>
    <div class="footer">
      <input type="text" class="textField" placeholder="Message..." />
      <button class="sendBtn" onclick="sendTxt();">
        SEND
      </button>
    </div>
    <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase.js"></script>
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyBSO1l02gRubi7mZnIWhkxMcuXE-oMu33g",
        authDomain: "converse-dd75d.firebaseapp.com",
        databaseURL: "https://converse-dd75d.firebaseio.com",
        projectId: "converse-dd75d",
        storageBucket: "converse-dd75d.appspot.com",
        messagingSenderId: "984079997699",
      };
      firebase.initializeApp(firebaseConfig);
    </script>
    <script>
      var lastTexts = [];
      var ID = "";
      setInterval(() => {
        document.querySelector(".messageBody").style.height =
          window.innerHeight / 16.00020157734 - 10 + "pc";
        if (document.querySelector(".textField").value.trim() != "")
          document.querySelector(".sendBtn").style.filter = "opacity(1)";
        else document.querySelector(".sendBtn").style.filter = "opacity(0)";
        document.querySelector(".textField").style.width =
          screen.width / 16.00020157734 - 7 + "pc";
        document.querySelector(".chats").style.height =
          window.innerHeight / 16.00020157734 - 15 + "pc";
      }, 50);
      document
        .querySelector(".submitBtn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          var firebaseref = firebase.database().ref();
          if (
            document.querySelector(".inputUserName").value.trim() != "" &&
            document.querySelector(".inputUserSLID").value.trim() != ""
          ) {
            for (
              var i = 0;
              i < document.querySelector(".inputUserSLID").value.trim().length;
              i++
            ) {
              var s = document
                .querySelector(".inputUserSLID")
                .value.trim()
                .charAt(i);
              if (
                s == "1" ||
                s == "2" ||
                s == "3" ||
                s == "4" ||
                s == "5" ||
                s == "6" ||
                s == "7" ||
                s == "8" ||
                s == "9" ||
                s == "0"
              )
                ID += document
                  .querySelector(".inputUserSLID")
                  .value.trim()
                  .charAt(i);
            }

            console.log(ID);
            $.getJSON(
              "https://converse-dd75d.firebaseio.com/users/" + ID + ".json",
              checkConnection
            );
            firebaseref
              .child("users")
              .child(ID)
              .set({
                name: document.querySelector(".inputUserName").value.trim(),
                connectionStatus: "online",
              });
            document.querySelector(
              ".userNameShow"
            ).innerHTML = document.querySelector(".inputUserName").value;
            document.querySelector(".proPic").src =
              "https://api.sololearn.com/Uploads/Avatars/" + ID + ".jpg";
            document.querySelector(".joiningPage").style.filter = "opacity(0)";
            setTimeout(() => {
              document.querySelector(".joiningPage").style.zIndex = "-10";
            }, 1000);

            setInterval(function () {
              $.getJSON(
                "https://converse-dd75d.firebaseio.com/users.json",
                updateChats
              );
            }, 1000);
          }
        });
      function updateChats(data) {
        document.querySelector(".chatsContainer").innerHTML = "";
        for (var i in data) {
          if (i != ID)
            document.querySelector(".chatsContainer").innerHTML +=
              '<div class="chat" onclick=openChatWindow("' +
              i +
              '","' +
              data[i].name +
              '","' +
              data[i].connectionStatus +
              '")><img src="https://api.sololearn.com/Uploads/Avatars/' +
              i +
              '.jpg" class="chatProPic"/><h2 class="chatName">' +
              data[i].name +
              "</h2></div>";
        }
      }
      var theirID = "",
        textUpdateInterval;
      var IDs = "";
      function openChatWindow(
        opponentID,
        opponentName,
        opponentConnectionStatus
      ) {
        theirID = opponentID;
        if (opponentConnectionStatus == "online") {
          document.querySelector(".profileImgContainer").style.border =
            "4px solid rgb(8, 255, 131)";
          document.querySelector(".profileImgContainer").style.boxShadow =
            "0 0 10px rgb(8, 255, 131)";
        } else {
          document.querySelector(".profileImgContainer").style.border =
            "4px solid tomato";
          document.querySelector(".profileImgContainer").style.boxShadow =
            "0 0 10px tomato";
        }
        document.querySelector(".name").innerHTML = opponentName;
        document.querySelector(".profileImg").src =
          "https://api.sololearn.com/Uploads/Avatars/" + opponentID + ".jpg";
        document.querySelector(".homePage").style.filter = "opacity(0)";
        setTimeout(() => {
          document.querySelector(".homePage").style.zIndex = "-2";
        }, 1000);
        IDs = parseInt(ID) < parseInt(theirID) ? ID + theirID : theirID + ID;
        textUpdateInterval = setInterval(function () {
          $.getJSON(
            "https://converse-dd75d.firebaseio.com/texts/" + IDs + ".json",
            callback
          );
        }, 500);
      }
      function sendTxt() {
        if (document.querySelector(".textField").value.trim() != "") {
          var firebaseref = firebase.database().ref();
          firebaseref
            .child("texts")
            .child(IDs)
            .push({
              id: ID,
              text: document.querySelector(".textField").value.trim(),
              timeStamp: new Date().getHours() + ":" + new Date().getMinutes(),
            });
          document.querySelector(".textField").value = "";
        }
      }
      document
        .querySelector(".textField")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            if (document.querySelector(".textField").value.trim() != "") {
              var firebaseref = firebase.database().ref();
              firebaseref
                .child("texts")
                .child(IDs)
                .push({
                  id: ID,
                  text: document.querySelector(".textField").value.trim(),
                  timeStamp:
                    new Date().getHours() + ":" + new Date().getMinutes(),
                });
              document.querySelector(".textField").value = "";
            }
          }
        });
      var pastLength = 0;
      function callback(response) {
        var presentLength = 0;
        document.querySelector(".messageBody").innerHTML = "<br><br>";
        for (var i in response) {
          if (response[i].id == ID)
            document.querySelector(".messageBody").innerHTML +=
              "<div class='textHolder' onclick=deleteMsg('" +
              i +
              "')><div class='myText' ><img src='https://api.sololearn.com/Uploads/Avatars/" +
              ID +
              ".jpg' class='myTextImg'><div class='myMyText'>" +
              response[i].text.replace(/</g, "&lt;").replace(/>/g, "&gt;") +
              "</div></div><div class='myTimeStamp'>" +
              response[i].timeStamp +
              "</div></div>";
          else
            document.querySelector(".messageBody").innerHTML +=
              "<div class='textHolder'><div class='theirText'><div class='theirTheirText'>" +
              response[i].text.replace(/</g, "&lt;").replace(/>/g, "&gt;") +
              "</div><img class='theirTextImg' src='https://api.sololearn.com/Uploads/Avatars/" +
              theirID +
              ".jpg'></div><div class='theirTimeStamp'>" +
              response[i].timeStamp +
              "</div></div>";
          presentLength++;
        }
        if (presentLength != pastLength) {
          pastLength = presentLength;
          document
            .querySelector(".messageBody")
            .scrollTo(0, document.querySelector(".messageBody").scrollHeight);
        }
        $.getJSON(
          "https://converse-dd75d.firebaseio.com/users/" + theirID + ".json",
          setTheirConnection
        );
      }
      function setTheirConnection(data) {
        if (data.connectionStatus == "online") {
          document.querySelector(".profileImgContainer").style.border =
            "4px solid rgb(8, 255, 131)";
          document.querySelector(".profileImgContainer").style.boxShadow =
            "0 0 10px rgb(8, 255, 131)";
        } else {
          document.querySelector(".profileImgContainer").style.border =
            "4px solid tomato";
          document.querySelector(".profileImgContainer").style.boxShadow =
            "0 0 10px tomato";
        }
      }
      function backToHome() {
        document.querySelector(".homePage").style.zIndex = "+6";
        document.querySelector(".homePage").style.filter = "opacity(1)";
        clearInterval(textUpdateInterval);
      }
      var isOnline = false;
      window.onload = function () {};
      function checkConnection(data) {
        if (data.connectionStatus == "offline") {
          isOnline = true;
        } else {
          isOnline = false;
        }
        connect();
      }
      document.querySelector(".proPic").addEventListener("click", connect);
      function connect() {
        if (isOnline) {
          firebase
            .database()
            .ref("users/" + ID + "/connectionStatus")
            .set("offline");
          isOnline = false;
          document.querySelector(".proPic").style.border = "4px solid tomato";
        } else {
          firebase
            .database()
            .ref("users/" + ID + "/connectionStatus")
            .set("online");
          document.querySelector(".proPic").style.border =
            "4px solid rgb(8, 255, 131)";
          isOnline = true;
        }
      }
      function deleteMsg(index) {
        console.log(index);
        var firebaseref = firebase.database().ref("texts/" + IDs + "/" + index);
        if (confirm("Do you really want to unsend the message?"))
          firebaseref.remove();
      }
    </script>
  </body>
</html>
